# Prerequisites
* Terraform, kubectl and gcloud are [installed](https://github.com/terraform-google-modules/terraform-google-kubernetes-engine#software-dependencies) and configured on the machine where Terraform is executed.
* The Service Account you execute the module with has the right [permissions](https://github.com/terraform-google-modules/terraform-google-kubernetes-engine#configure-a-service-account).
* The Compute Engine and Kubernetes Engine APIs are [active](https://github.com/terraform-google-modules/terraform-google-kubernetes-engine#enable-apis) on the project you will launch the cluster in.
* If you are using a Shared VPC, the APIs must also be activated on the Shared VPC host project and your service account needs the proper permissions there.
* A Spotinst account [connected](https://api.spotinst.com/elastigroup-for-google-cloud/tutorials/connect-spotinst-to-a-gcp-account/) to your GCP project.
* A Spotinst [token](https://api.spotinst.com/spotinst-api/administration/create-an-api-token/?hilite=%27token%27).

#### In order to configure the google terraform provider credentials:
Set the following env var with the credentials json key file
export GOOGLE_CLOUD_KEYFILE_JSON=<PATH_TO_JSON_KEY_FILE>

## Template variables:
| Name                                                                                                 | Description                                                                                                                                                                                                                                                                                                                                                 | Type   | Default                                  |
|------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------|------------------------------------------|
| spotinst\_token                                                                                      | A spotinst token                                                                                                                                                                                                                                                                                                                                            | string | “”                                       |
| spotinst\_account                                                                                    | The spotinst account you’d wish to create the Ocean cluster in                                                                                                                                                                                                                                                                                              | string | “”                                       |
| project\_id                                                                                          | The GCP project id                                                                                                                                                                                                                                                                                                                                          | string | “”                                       |
| is\_regional                                                                                         | Specifying weather its a regional or zonal cluster                                                                                                                                                                                                                                                                                                          | bool   | FALSE                                    |
| cluster\_name                                                                                        | The name of the cluster \(required\)                                                                                                                                                                                                                                                                                                                        | string | “”                                       |
| region                                                                                               | The region to host the cluster in \(optional if zonal cluster / required if regional\)                                                                                                                                                                                                                                                                      | string | “”                                       |
| zones                                                                                                | "The zones to host the cluster in \(optional if regional cluster / required if zonal\). In case you choose a zonal cluster, the first zone in the list will be used as the cluster location" | list\(string\)                                                                                                                                                                                                                                                                                                                                              | “”     |
| network                                                                                              | The VPC network to host the cluster in \(required\)                                                                                                                                                                                                                                                                                                         | string | “”                                       |
| subnetwork                                                                                           | The subnetwork to host the cluster in \(required\)                                                                                                                                                                                                                                                                                                          | string | “”                                       |
| ip\_range\_pods                                                                                      | The name of the secondary subnet IP range to use for pods                                                                                                                                                                                                                                                                                                   | string | “”                                       |
| ip\_range\_services                                                                                  | The name of the secondary subnet range to use for services                                                                                                                                                                                                                                                                                                  | string | “”                                       |
| http\_load\_balancing                                                                                | Enable httpload balancer addon                                                                                                                                                                                                                                                                                                                              | bool   | TRUE                                     |
| horizontal\_pod\_autoscaling                                                                         | Enable horizontal pod autoscaling addon                                                                                                                                                                                                                                                                                                                     | bool   | TRUE                                     |
| network\_policy                                                                                      | Enable network policy addon                                                                                                                                                                                                                                                                                                                                 | bool   | TRUE                                     |
| compute\_engine\_service\_account                                                                    | The service account to run nodes as if not overridden in node\_pools\. The create\_service\_account variable default value \(true\) will cause a cluster\-specific service account to be created\.                                                                                                                                                          | string | “”                                       |
| create\_service\_account                                                                             | Defines if a service account specified to run nodes should be created\.                                                                                                                                                                                                                                                                                     | bool   | TRUE                                     |
| skip\_provisioners                                                                                   | Flag to skip all local\-exec provisioners within the GKE module\.                                                                                                                                                                                                                                                                                           | bool   | FALSE                                    |
| location                                                                                             | The cluster location \(should be either the region or the zone where the cluster resides in\)                                                                                                                                                                                                                                                               | string | “”                                       |
| kubernetes\_version                                                                                  | The Kubernetes version of the masters\. If set to 'latest' it will pull latest available version in the selected region\.                                                                                                                                                                                                                                   | string | “latest”                                 |
| monitoring\_service                                                                                  | The monitoring service that the cluster should write metrics to\. Automatically send metrics from pods in the cluster to the Google Cloud Monitoring API\. VM metrics will be collected by Google Compute Engine regardless of this setting Available options include monitoring\.googleapis\.com, monitoring\.googleapis\.com/kubernetes \(beta\) and none | string | “monitoring\.googleapis\.com/kubernetes” |
| logging\_service                                                                                     | The logging service that the cluster should write logs to\. Available options include logging\.googleapis\.com, logging\.googleapis\.com/kubernetes \(beta\), and none                                                                                                                                                                                      | string | “logging\.googleapis\.com/kubernetes”    |

## Terraform Template workflow:
* Creates a GKE cluster using google [GKE module](https://github.com/terraform-google-modules/terraform-google-kubernetes-engine).
* Import the GKE cluster to Ocean using the “spotinst_ocean_gke_import” resource (please note that this is an import resource only).
* Install the spotinst-kubernetes-cluster-controller on top of the cluster.
* Setting the initial node pools size the 0.

## Please note:
* Since the master automatically scales based on the number of nodes registered to the cluster, in order to be able to create Kubernetes resources on top of the cluster as part of the TF template, it’s recommended to set the initial node pool size to at least 6 in order for the cluster to upgrade to the biggest size possible (https://cloud.google.com/blog/products/gcp/cutting-cluster-management-fees-on-google-kubernetes-engine).
* The total creation process takes around 10-15 minutes.
* This template has to run on a linux interpreter.
* At the end of the creation all node pools capacity will be set modified to 0 and thats in order for Ocean to take control over the capacity managment of the cluster, please note that the cluster will be updating few minutes after the creation.
* The Ocean cluster will be created with a minimum capacity of 1 node (in order to make sure the spotinst-kubernetes-cluster-controller is running).
